name: Test

on:
  workflow_dispatch:
  
  deployment:
    runs-on: self-hosted
    needs: build
    environment:
      name: 'Pull Request'
      url: ${{ steps.deploy-to-testing-webapp.outputs.webapp-url }}

    steps:
      - name: Clean up old docs
        run:  
          Get-Process | foreach{$processVar = $_;$_.Modules | foreach{if($_.FileName -eq ((get-location).path + "\CyberForceWeb.Web.dll")){taskkill /F /PID $processVar.id}}}

      - name: Run new version
        run:  
          run: RUNNER_TRACKING_ID="" && (start powershell {dotnet CyberForceWeb.Web.dll})
